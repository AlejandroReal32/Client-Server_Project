{% comment %}
    PLANTILLA GESTIÓN DE CATEGORÍAS - PANEL DE ADMINISTRACIÓN
    ===================================================
    Esta plantilla permite a los administradores gestionar las categorías de productos:
    - Ver lista de categorías existentes
    - Crear nuevas categorías
    - Editar categorías existentes
    - Eliminar categorías (con confirmación)
    
    Variables de contexto esperadas:
    - categorias: QuerySet de objetos Categoria
    - mensaje: Mensaje de éxito/error (opcional)
{% endcomment %}

{% extends 'tienda/base.html' %}
{% load static %}

{% block title %}Gestión de Categorías{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- Encabezado de la página -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3 mb-0" id="page-title">Gestión de Categorías</h1>
        <!-- Botón para crear nueva categoría -->
        <a href="{% url 'categoria_nueva' %}" 
           class="btn btn-success" 
           aria-label="Crear nueva categoría">
            <i class="fas fa-plus-circle me-1"></i> Nueva Categoría
        </a>
    </div>
    
    <!-- Tabla de categorías -->
    <div class="table-responsive">
        <table class="table table-striped table-hover" 
               aria-labelledby="page-title"
               aria-describedby="categorias-desc">
            <caption id="categorias-desc">
                Lista de categorías de productos disponibles en el sistema. 
                Utilice los botones de acción para editar o eliminar categorías.
            </caption>
            <thead class="table-dark">
                <tr>
                    <th scope="col">Nombre</th>
                    <th scope="col">Descripción</th>
                    <th scope="col" class="text-end">Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% if categorias %}
                    {% for cat in categorias %}
                        <tr>
                            <!-- Nombre de la categoría -->
                            <td class="align-middle">{{ cat.nombre }}</td>
                            <!-- Descripción de la categoría o texto por defecto -->
                            <td class="align-middle">{{ cat.descripcion|default:"Sin descripción" }}</td>
                            <td class="text-end">
                                <!-- Botón de editar categoría -->
                                <a href="{% url 'categoria_editar' cat.pk %}" 
                                   class="btn btn-warning btn-sm me-1" 
                                   aria-label="Editar categoría {{ cat.nombre }}"
                                   title="Editar">
                                    <i class="fas fa-edit"></i>
                                    <span class="d-none d-md-inline">Editar</span>
                                </a>
                                
                                <!-- Botón de eliminar categoría -->
                                <a href="{% url 'categoria_eliminar' cat.pk %}" 
                                   class="btn btn-danger btn-sm" 
                                   aria-label="Eliminar categoría {{ cat.nombre }}"
                                   title="Eliminar"
                                   onclick="return confirm('¿Está seguro de que desea eliminar la categoría {{ cat.nombre }}? Esta acción no se puede deshacer.');">
                                    <i class="fas fa-trash-alt"></i>
                                    <span class="d-none d-md-inline">Eliminar</span>
                                </a>
                            </td>
                        </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="3" class="text-center py-4">
                            <div class="alert alert-info mb-0" role="alert">
                                <i class="fas fa-info-circle me-2"></i>
                                No hay categorías registradas. 
                                <a href="{% url 'categoria_nueva' %}" class="alert-link">
                                    Crear la primera categoría
                                </a>
                            </div>
                        </td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
    
    <!-- Botón de volver -->
    <div class="mt-4">
        <a href="{% url 'inicio' %}" 
           class="btn btn-secondary" 
           aria-label="Volver al inicio">
            <i class="fas fa-arrow-left me-1"></i> Volver al Inicio
        </a>
    </div>
    
    <!-- Sección de mensajes (para mostrar confirmaciones/errores) -->
    {% if messages %}
        <div class="mt-4">
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
                </div>
            {% endfor %}
        </div>
    {% endif %}
</div>

<!-- Script para mejorar la accesibilidad de la tabla -->
{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Hacer las filas de la tabla más accesibles
    const tableRows = document.querySelectorAll('tbody tr');
    tableRows.forEach(row => {
        row.setAttribute('role', 'row');
        row.querySelectorAll('td').forEach((cell, index) => {
            if (index === 2) return; // Saltar celdas de acción
            cell.setAttribute('role', 'cell');
            cell.setAttribute('tabindex', '0');
        });
    });
    
    // Mejorar la accesibilidad de los botones de acción
    const actionButtons = document.querySelectorAll('.btn-sm');
    actionButtons.forEach(button => {
        button.setAttribute('aria-label', button.textContent.trim() || button.title);
    });
});
</script>
{% endblock %}

{% endblock %}
